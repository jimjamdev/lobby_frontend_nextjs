import Head from 'next/head';

import { Box } from '~components/atoms/Box';
import { Container } from '~components/atoms/Container';
import { Portal } from '~components/atoms/Portal/Portal';
import { DefaultLayout } from '~components/layouts/DefaultLayout';
import { useGetGamesQuery } from '~store/features/cms/games';
import { TPage } from '~types/page.types';
import { handleError } from '~utils/handleError';

// eslint-disable-next-line react/function-component-definition
const Home: TPage = ({ defaultData }) => {
  console.log('defaultData', defaultData);
  const {
    data: games,
    isLoading: isGamesLoading,
    error: gamesError,
  } = useGetGamesQuery({ page: 1 });

  return (
    <>
      <Head>
        <title>Lobby - Green Jade</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Portal isOpen>
        <Box bg="primary.4" position="absolute" top="5em">SOME PORTAL</Box>
      </Portal>
      <Portal isOpen>
        <Box bg="primary.6" position="absolute" top="10em">SOME PORTAL 2</Box>
      </Portal>

      <Container as="section">
        {games && games?.meta?.pagination?.total} Results
        {gamesError && handleError(gamesError)}
        {isGamesLoading && <div>Loading...</div>}
        <Box as="ul" padding={0} margin={0}>
          {games?.data
            && games?.data?.map((game) => <Box bg="secondary.4" as="li" margin="0" padding={3} key={game.id}>{game.name}</Box>)}
        </Box>
      </Container>

      <Box display="block" height="20rem" bg="mono.1" marginTop={3}>BOX</Box>

    </>
  );
};

Home.getLayout = function getLayout(page) {
  return <DefaultLayout>{page}</DefaultLayout>;
};
/*
export async function getServerSideProps() {
  const { data: games } = await store.dispatch(getGames.initiate({ page: 1 }));
  return {
    props: {
      defaultData: {
        games,
      },
    },
  };
} */

export default Home;
